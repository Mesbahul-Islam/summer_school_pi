<!DOCTYPE html>
<html>
<head>
    <title>Sensor Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #f8f9fa; padding: 20px; }
        canvas { max-width: 800px; margin: 20px auto; display: block; }
    </style>
</head>
<body>
    <h1>Live Sensor Dashboard</h1>

    <canvas id="distanceChart"></canvas>
    <canvas id="motionChart"></canvas>

    <script>
        const distanceCtx = document.getElementById('distanceChart').getContext('2d');
        const motionCtx = document.getElementById('motionChart').getContext('2d');

        const distanceChart = new Chart(distanceCtx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Distance (cm)', data: [], borderColor: 'blue', fill: false }] },
            options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });

        const motionChart = new Chart(motionCtx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Motion', data: [], borderColor: 'red', fill: false }] },
            options: { responsive: true, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
        });

        async function fetchData() {
            const response = await fetch("/data");
            const data = await response.json();

            // Extract time, distance, and motion
            const times = data.map(d => d.time);
            const distances = data.map(d => d.distance);
            const motions = data.map(d => d.motion ? 1 : 0); // boolean to 0/1

            distanceChart.data.labels = times;
            distanceChart.data.datasets[0].data = distances;
            distanceChart.update();

            motionChart.data.labels = times;
            motionChart.data.datasets[0].data = motions;
            motionChart.update();
        }

        setInterval(fetchData, 1000); // refresh every second
        fetchData();
    </script>
</body>
</html>
